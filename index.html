<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title> ç™½åœ­æŠ•è³‡å°éŠæˆ² </title>
  <style>
    body {
      font-family: 'Microsoft JhengHei', sans-serif;
      text-align: center;
      background-color: #f0f0f0;
      padding: 20px;
    }

    h1 {
      background-color: #2f3e46;
      color: white;
      padding: 20px 0;
      margin-bottom: 30px;
    }

    button {
      width: 140px;
      height: 40px;
      margin: 5px;
      font-size: 15px;
      border-radius: 6px;
      background-color: #2a9d8f;
      color: white;
      border: none;
      cursor: pointer;
    }

    select {
      font-size: 16px;
      margin: 5px;
      padding: 5px;
    }

    .card {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-top: 20px;
      width: 80%;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      white-space: pre-line;
    }

    #money, #debt, #turn {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

  <h1>ç™½åœ­æŠ•è³‡å°éŠæˆ²</h1>

  <div id="money">ç›®å‰è³‡ç”¢ï¼š1000 éŒ¢</div>
  <div id="debt">è² å‚µï¼š0 éŒ¢</div>
  <div id="turn">å›åˆï¼š1 / 20</div>
  <div id="inventory" class="card">
    <strong>ğŸ“¦ å•†å“åº«å­˜ï¼š</strong>
    <ul id="inventoryList"></ul>
  </div>

  <br>
  <button onclick="showAdvice()">ğŸ“ˆ æŠ•è³‡å»ºè­°</button>
  <div id="adviceBox" class="card"></div>

  <br><br>
  <label for="regionSelect">é¸æ“‡åœ°å€ï¼š</label>
  <select id="regionSelect">
    <option value="ç‡•åœ‹">ç‡•åœ‹</option>
    <option value="è¶™åœ‹">è¶™åœ‹</option>
    <option value="æ¥šåœ‹">æ¥šåœ‹</option>
  </select>

  <label for="productSelect">é¸æ“‡å•†å“ï¼š</label>
  <select id="productSelect">
    <option value="é¹½">é¹½</option>
    <option value="æœ¨æ">æœ¨æ</option>
    <option value="çµ²ç¶¢">çµ²ç¶¢</option>
  </select>

  <br><br>
  <button onclick="buyProduct()">ğŸ›’ é€²è²¨</button>
  <button onclick="sellProduct()">ğŸ’¼ å‡ºè²¨</button>

  <div id="tradeResultBox" class="card"></div>

  <br>
  <button onclick="showMap()">ğŸŒ åœ°å€è²¿æ˜“åœ°åœ–</button>
  <div id="mapBox" class="card"></div>

  <div id="history" class="card">
    <strong>ğŸ“š äº¤æ˜“ç´€éŒ„ï¼š</strong>
    <ul id="historyList"></ul>
  </div>

  <script>
    let totalMoney = 1000;
    let debt = 0;
    let turn = 1;
    const maxTurns = 20;

    const inventory = { "é¹½": 0, "æœ¨æ": 0, "çµ²ç¶¢": 0 };

    const basePrices = {
      "ç‡•åœ‹": { "é¹½": 300, "æœ¨æ": 150, "çµ²ç¶¢": 100 },
      "è¶™åœ‹": { "é¹½": 200, "æœ¨æ": 250, "çµ²ç¶¢": 100 },
      "æ¥šåœ‹": { "é¹½": 150, "æœ¨æ": 200, "çµ²ç¶¢": 500 }
    };

    const marketPrices = JSON.parse(JSON.stringify(basePrices));

    function fluctuateMarket() {
      for (let region in marketPrices) {
        for (let product in marketPrices[region]) {
          let npcImpact = Math.floor(Math.random() * 51 - 25);
          marketPrices[region][product] += npcImpact;
          marketPrices[region][product] = Math.max(20, marketPrices[region][product]);
        }
      }
    }

    function updateDisplay() {
      document.getElementById("money").innerText = `ç›®å‰è³‡ç”¢ï¼š${totalMoney} éŒ¢`;
      document.getElementById("debt").innerText = `è² å‚µï¼š${debt} éŒ¢`;
      document.getElementById("turn").innerText = `å›åˆï¼š${turn} / ${maxTurns}`;

      const invList = document.getElementById("inventoryList");
      invList.innerHTML = "";
      for (let item in inventory) {
        const li = document.createElement("li");
        li.textContent = `${item}ï¼š${inventory[item]} å–®ä½`;
        invList.appendChild(li);
      }
    }

    function showAdvice() {
      const adviceList = [
        "èƒ½å¸‚å‰‡å¸‚ï¼Œç„¡å¸‚å‰‡å»ã€‚",
        "å•†è€…ï¼Œé€åˆ©ä¹Ÿï¼Œç„¶äº¦è§€æ™‚è€Œå‹•ã€‚",
        "çŸ¥å‹¢è€…å¯Œï¼Œå¯Ÿäººè€…å®‰ã€‚",
        "è²¨æ‚–è€Œå…¥è€…ï¼Œäº¦æ‚–è€Œå‡ºã€‚",
        "å› åœ°åˆ¶å®œï¼Œæ“‡äººäº¤æ˜“ã€‚"
      ];
      const advice = adviceList[Math.floor(Math.random() * adviceList.length)];
      document.getElementById("adviceBox").innerText = "ğŸ“œ ç™½åœ­èªéŒ„ï¼š\n" + advice;
    }

    function logHistory(text) {
      const list = document.getElementById("historyList");
      const item = document.createElement("li");
      item.textContent = text;
      list.insertBefore(item, list.firstChild);
    }

    function randomEvent() {
      const rand = Math.random();
      let result = "";
      if (rand < 0.15) {
        result = "âš ï¸ é‡åˆ°å‡è²¨ï¼Œç„¡æ³•è³£å‡ºï¼";
      } else if (rand < 0.3) {
        totalMoney -= 50;
        result = "ğŸš« åœ°æ–¹ç¨…çªè¥²ï¼Œæå¤± 50 éŒ¢ï¼";
      } else if (rand < 0.4) {
        debt += 100;
        result = "ğŸ’° å‘ç•¶é‹ªå€Ÿæ¬¾ 100 éŒ¢ï¼ˆæœªä¾†éœ€é‚„ 150ï¼‰";
        totalMoney += 100;
      }
      return result;
    }

    function buyProduct() {
      const region = document.getElementById("regionSelect").value;
      const product = document.getElementById("productSelect").value;
      const cost = marketPrices[region][product];

      if (totalMoney >= cost) {
        totalMoney -= cost;
        inventory[product]++;
        logHistory(`ğŸ›’ åœ¨${region}è³¼è²·${product}ï¼ŒèŠ±è²» ${cost} éŒ¢ã€‚`);
      } else {
        logHistory(`âŒ è³‡é‡‘ä¸è¶³ï¼Œç„¡æ³•è³¼è²·${product}ï¼`);
      }

      nextTurn();
    }

    function sellProduct() {
      const region = document.getElementById("regionSelect").value;
      const product = document.getElementById("productSelect").value;

      if (inventory[product] <= 0) {
        logHistory(`âŒ æ²’æœ‰åº«å­˜ï¼Œç„¡æ³•è³£å‡º${product}ï¼`);
        return;
      }

      let output = "";
      const price = marketPrices[region][product];
      inventory[product]--;

      const event = randomEvent();
      if (event.includes("å‡è²¨")) {
        output = event;
      } else {
        totalMoney += price;
        output = `ğŸ’° åœ¨${region}è³£å‡º${product}ï¼Œæ”¶å…¥ ${price} éŒ¢ã€‚`;
        if (event) output += "\n" + event;
      }

      document.getElementById("tradeResultBox").innerText = output;
      logHistory(output);

      nextTurn();
    }

    function showMap() {
      const mapInfo = "ğŸ“ åœ°å€éœ€æ±‚æ¨¡æ“¬ï¼š\n- ç‡•åœ‹ï¼šç¼ºé¹½\n- è¶™åœ‹ï¼šæœ¨æéœ€æ±‚é«˜\n- æ¥šåœ‹ï¼šçµ²ç¶¢ç››è¡Œ";
      document.getElementById("mapBox").innerText = mapInfo;
    }

    function nextTurn() {
      turn++;
      fluctuateMarket();

      if (turn > maxTurns) {
        const penalty = Math.floor(debt * 1.5);
        totalMoney -= penalty;
        alert(`ğŸ¯ éŠæˆ²çµæŸï¼ä½ æ¬ å‚µ ${debt}ï¼Œæ‰£é™¤é‚„æ¬¾ ${penalty} éŒ¢ã€‚\næœ€çµ‚è³‡ç”¢ï¼š${totalMoney} éŒ¢`);
      }

      updateDisplay();
    }

    window.onload = () => {
      updateDisplay();
    };
  </script>
</body>
</html>
